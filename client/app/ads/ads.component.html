<app-loading [condition]="isLoading"></app-loading>

<app-toast [message]="toast.message"></app-toast>

<div class="card" *ngIf="!isLoading">
  <h4 class="card-header">Current ads ({{ads.length}})</h4>
  <div class="card-block">
    <table class="table table-bordered table-striped">
      <thead class="thead-default">
      <tr>
        <th>Name</th>
        <th>Text</th>
        <th>Screens</th>
        <th>Images</th>
        <th>Template</th>
        <th>Duration</th>
        <th>From date</th>
        <th>To date</th>
        <th>Days</th>
        <th>From Time</th>
        <th>To Time</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody *ngIf="ads.length === 0">
      <tr>
        <td colspan="4">There are no ads in the DB. Add a new ad below.</td>
      </tr>
      </tbody>
      <tbody *ngIf="!isEditing">
      <tr *ngFor="let ad of ads">
        <td>{{ad.name}}</td>
        <td>
          <select>
            <option *ngFor="let text of ad.adText">{{text}}</option>
          </select>
        </td>
        <td>{{ad.screens}}</td>
        <td>{{ad.imageLink}}</td>
        <td>{{ad.templateLink}}</td>
        <td>{{ad.ttl}}</td>
        <td>{{ad.timeFrames.startDate}}</td>
        <td>{{ad.timeFrames.endDate}}</td>
        <td>{{ad.timeFrames.days}}</td>
        <td>{{ad.timeFrames.startTime}}</td>
        <td>{{ad.timeFrames.endTime}}</td>
        <td>
          <button class="btn btn-sm btn-warning" (click)="enableEditing(ad)"><i class="fa fa-pencil"></i> Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deleteAd(ad)"><i class="fa fa-trash"></i> Delete</button>
        </td>
      </tr>
      </tbody>
      <tbody *ngIf="isEditing">
      <tr>
        <td colspan="4">
          <form class="form-inline" #form="ngForm" (ngSubmit)="editAd(ad)" style="display:inline">
            <div class="form-group">
              <input class="form-control" name="name" [(ngModel)]="ad.name" placeholder="Name" required>
            </div>
            <div class="form-group">
              <input class="form-control" type="number" name="age" [(ngModel)]="ad.age" placeholder="Age" min="0" required>
            </div>
            <div class="form-group">
              <input class="form-control" type="number" name="weight" [(ngModel)]="ad.weight" placeholder="Weight" step="any" min="0" required>
            </div>
            <button class="btn btn-sm btn-primary" type="submit" [disabled]="!form.form.valid"><i class="fa fa-floppy-o"></i> Save</button>
          </form>
          <button class="btn btn-sm btn-warning" (click)="cancelEditing()"><i class="fa fa-times"></i> Cancel</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="card" *ngIf="!isEditing">
  <h4 class="card-header">Add new advertisement</h4>
  <div class="card-block">
    <form class="form-inline" [formGroup]="addAdForm" (ngSubmit)="addAd()" style="text-align:center">
    <table class="table table-hover">
      <thead>
      <tr>
        <th>
          <div class="form-inline">
            Name: <input class="form-control" name="name"
                         formControlName="name" [(ngModel)]="ad.name"
                         placeholder="Name">
          </div>
        </th>
        <th>
          <div class="form-inline" [formGroup]="myGroup" >
            Text: <input class="form-control"
                         formControlName="firstName"
                         placeholder="Text"
                         step="any"
                         [(ngModel)]="currentText">

            <button class="btn-secondary" (click)="addTextToArray()" type="button"> add </button>
          </div>
          <div class="form-inline">
          <select [(ngModel)]="selectedText" [ngModelOptions]="{standalone: true}">
            <option *ngFor="let text of ad.adText" [ngValue]="text">{{text}}</option>
          </select>
            <button type="button" (click)="removeTextFromArray()"> delete </button>
          </div>

        </th>
      </tr>
      <tr>
        <th>
          <div class="form-inline" [formGroup]="myGroup">
            Screen: <ss-multiselect-dropdown [options]="screenOptions"
                                     [(ngModel)]="screenOption"
                                     [ngModelOptions]="{standalone: true}"
                                     (ngModelChange)="onChangeScreen($event)"
            ></ss-multiselect-dropdown>
          </div>
        </th>
        <th>
          <div class="form-inline" [formGroup]="myGroup">
            Images: <ss-multiselect-dropdown [options]="imageOptions"
                                     [(ngModel)]="imageOption"
                                     [ngModelOptions]="{standalone: true}"
                                     (ngModelChange)="onChangeImage($event)"
            ></ss-multiselect-dropdown>
          </div>
        </th>
      </tr>
      <tr>
        <th>
          <div class="form-inline" [formGroup]="myGroup">
            Templates: <select [(ngModel)]="ad.templateLink"
                               [ngModelOptions]="{standalone: true}">
            <option *ngFor="let option of templateOptions"
                    [ngValue]="option">
              {{option}}
            </option>
          </select>
          </div>
        </th>
        <th>
          <div class="form-inline">
            Duration(Min.): <input class="form-control" type="number" name="ttl"
                     [(ngModel)]="ad.ttl"
                     [ngModelOptions]="{standalone: true}"
                    placeholder="Duration in min"
                   step="any" min="1" max="60">
          </div>
        </th>
      </tr>
      <tr>
        <th>
          <div class="form-inline">
            <form #myForm="ngForm" novalidate class="form-inline">
              <my-date-picker name="mydate" class="datePicker"
                                          [options]="datePickerOptions"
                                          [placeholder]="startDatePlaceHolder"
                                          [selector]="selector"
                                          (dateChanged)="onStartDateChanged($event)"
            ></my-date-picker>
            </form>
          </div>
        </th>
        <th>
          <div class="form-inline">
            <form #myForm="ngForm" novalidate class="form-inline">
              <my-date-picker name="mydate" class="datePicker"
                              [options]="datePickerOptions"
                              [placeholder]="endDatePlaceHolder"
                              [selector]="selector"
                              (dateChanged)="onEndDateChanged($event)"
              ></my-date-picker>
            </form>
          </div>
        </th>
      </tr>
      <tr>
        <th>
          <div class="form-inline" [formGroup]="myGroup">
            Days: <ss-multiselect-dropdown [options]="dayOptions"
                                                [(ngModel)]="dayOption"
                                                [ngModelOptions]="{standalone: true}"
                                                (ngModelChange)="onChangeDay($event)"
          ></ss-multiselect-dropdown>
          </div>
        </th>
        <th>
          <tr>
           <th >Start Time:</th>
            <th>
                <div class="time-picker-label">
                  <input class="form-control time-picker"
                         [ngModelOptions]="{standalone: true}" type="number"
                         name="startTimeHour" [(ngModel)]="startTimeHour"
                         placeholder="Hour" min="0" max="23" required
                          (change)="changeStartTime($event)">
                </div>
            </th>
            <th>
              <div class="time-picker-label">
                <input class="form-control time-picker" [ngModelOptions]="{standalone: true}"
                       type="number" name="startTimeMinute" (change)="changeStartTime($event)"
                       [(ngModel)]="startTimeMinute" placeholder="Min."
                       min="0" max="59" required>
              </div>
            </th>
          </tr>
        </th>
      </tr>
      <tr>
        <th></th>
        <th>
      <tr>
        <th >End Time:</th>
        <th>
          <div class="time-picker-label">
            <input class="form-control time-picker"
                   [ngModelOptions]="{standalone: true}"
                   type="number"
                   name="endTimeHour" (change)="changeEndTime($event)"
                   [(ngModel)]="endTimeHour" placeholder="Hour"
                   min="0" max="23" required>
          </div>
        </th>
        <th>
          <div class="time-picker-label">
            <input class="form-control time-picker" [ngModelOptions]="{standalone: true}"
                   type="number" name="endTimeMinute"
                   [(ngModel)]="endTimeMinute" (change)="changeEndTime($event)"
                   placeholder="Min." min="0" max="59" required>
          </div>
        </th>
      </tr>
        </th>
      </tr>
      </thead>
    </table>


      <button class="btn btn-primary" type="submit" [disabled]="!addAdForm.valid"><i class="fa fa-floppy-o"></i> Add</button>
    </form>
  </div>
</div>
